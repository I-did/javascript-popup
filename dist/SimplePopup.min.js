(function(a){"function"==typeof define&&define.amd?define([],a):"object"==typeof exports?module.exports=a():window.SimplePopup=a()})(function(){var a=function(){return function(a){var b,c,d,e=this;return e.options=b=a,e.defaults=c={popup:"",overlay:"",openBtn:"",closeBtn:"",scrollThreshold:100,escToClose:!0,clickToClose:"overlay",animation:"",transition:{popup:{property:"opacity",from:0,to:1,timigFunction:"ease",delay:0,duration:.5},overlay:{property:"opacity",from:0,to:1,timigFunction:"ease",delay:0,duration:.5}}},e.initials=d={$popup:null,$overlay:null,$closeBtn:null,$openBtn:null,$inputs:null},e.assign(c,b),e.assign(d,e),e.iosRegExp=/iPhone|iPad|iPod/i,e.init(),console.log(e),e.$popup}}();return a.prototype.assign=function(a,b){for(var c in a)void 0===b[c]?b[c]=a[c]:"object"==typeof b[c]&&this.assign(a[c],b[c])},a.prototype.dispatchEvent=function(a,b){if("function"==typeof window.CustomEvent){var c=new CustomEvent(b);a.dispatchEvent(c)}},a.prototype.init=function(){for(var a,b=this,c=b.options,d=["popup","overlay","closeBtn"],e=0;e<d.length;e++)if(a="$"+d[e],!1!==b[a]&&""!==c[d[e]]&&(b[a]=document["querySelector"+(2===e?"All":"")](c[d[e]]),"popup"===d[e]&&!b[a]))return;b.$popup.ctx=b,b.openPopupHandler={handleEvent:b.openPopup,ctx:b},b.closePopupHandler={handleEvent:b.closePopup,ctx:b},b.$popup.openPopup=b.openPopup,b.$popup.closePopup=b.closePopup,b.initEvents(),b.initOpenBtns()},a.prototype.initEvents=function(){var a=this;if(a.$closeBtn)for(var b=0;b<a.$closeBtn.length;b++)a.$closeBtn[b]&&a.$closeBtn[b].addEventListener("click",a.closePopupHandler);a.initAnimationEndEvents(a,"popup"),a.initAnimationEndEvents(a,"overlay"),a.dispatchEvent(a.$popup,"popupinit")},a.prototype.initAnimationEndEvents=function(a,b){var c=a["$"+b];if(c){var d=a.options.animation[b],e=a.options.transition[b];d?c.addEventListener("animationend",function(){event.animationName===d.open.name?a.dispatchEvent(c,b+"open"):(c.style.animation="",c.classList.remove("active"),a.dispatchEvent(c,b+"close"))}):e&&(c.style[e.property]=e.from,c.addEventListener("transitionend",function(){c.style[e.property]==e.to?a.dispatchEvent(c,b+"open"):(c.style.transition="",c.classList.remove("active"),a.dispatchEvent(c,b+"close"))}))}},a.prototype.initOpenBtns=function(){var a=this,b=a.options.openBtn;b&&(a.$openBtn={add:function(b){a.options.openBtn+=", "+b,this.refresh()},refresh:function(){this.elements=[];for(var b=document.querySelectorAll(a.options.openBtn),c=0;c<b.length;c++)this.elements.push(b[c]),b[c]&&b[c].addEventListener("click",a.openPopupHandler);a.$popup.openBtn=a.$openBtn}},a.$openBtn.refresh())},a.prototype.playAnimation=function(a,b){var c=this,d=c["$"+a],e=c.options.animation[a]&&c.options.animation[a][b],f=c.options.transition[a];if(setTransition=function(a){a=a||"to";var b=f.property,c=f.timigFunction,e=f.delay+"s",g=f.duration+"s";d.style.transition||(d.style.transition=b+" "+c+" "+g+" "+e),d.style[b]=f[a]},e){var g=e.name,h=(e.duration||.5)+"s",i=(e.delay||0)+"s",j=e.timigFunction||"ease";d.style.animation=g+" "+j+" "+h+" "+i}else f&&("open"===b?setTimeout(setTransition,1):setTransition("from"))},a.prototype.openPopup=function(){var a=this.ctx||this,b=a.$overlay,c=a.$popup;a.iosFix(),c.caller=event&&event.currentTarget,c.classList.contains("active")||(a.pageY=pageYOffset,c.classList.add("active"),a.playAnimation("popup","open"),b&&(b.classList.add("active"),a.playAnimation("overlay","open"),b.addEventListener("click",a.closePopupHandler)),a.options.escToClose&&document.addEventListener("keyup",a.closePopupHandler),document.addEventListener("scroll",a.closePopupHandler),a.dispatchEvent(c,"popupbeforeopen"))},a.prototype.closePopup=function(){var a=Math.abs;if(!(event&&"keyup"===event.type&&27!==event.keyCode)){var b=this.ctx||this,c=b.$popup,d=b.$overlay;event&&"scroll"===event.type&&a(pageYOffset-b.pageY)<=b.options.scrollThreshold||event&&"scroll"===event.type&&0<b.$inputs.length&&b.$inputs.some(function(a){return a===document.activeElement})||(c.classList.contains("active")&&(b.playAnimation("popup","close"),d&&b.playAnimation("overlay","close")),b.options.escToClose&&document.removeEventListener("keyup",b.closePopupHandler),d&&d.removeEventListener("click",b.closePopupHandler),document.removeEventListener("scroll",b.closePopupHandler),b.dispatchEvent(c,"popupbeforeclose"))}},a.prototype.iosFix=function(){var a=this;if(a.$inputs=[],a.iosRegExp.test(navigator.userAgent))for(var b=a.$popup.querySelectorAll("input, textarea"),c=0;c<b.length;c++)a.$inputs.push(b[c])},a});