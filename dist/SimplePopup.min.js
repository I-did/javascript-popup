(function(a){"function"==typeof define&&define.amd?define([],a):"object"==typeof exports?module.exports=a():window.SimplePopup=a()})(function(){var a=function(){return function(a){var b,c,d,e=this;return e.options=b=a,e.defaults=c={popup:"",overlay:"",openBtn:"",closeBtn:"",scrollThreshold:100,esc:!0},e.initials=d={$popup:null,$overlay:null,$closeBtn:null,$openBtn:null,$inputs:null},e.assign(c,b),e.assign(d,e),e.iosRegExp=/iPhone|iPad|iPod/i,e.init(),e.$popup}}();return a.prototype.assign=function(a,b){for(var c in a)void 0===b[c]&&(b[c]=a[c])},a.prototype.init=function(){for(var a,b=this,c=b.options,d=["popup","overlay","closeBtn"],e=0;e<d.length;e++)if(a="$"+d[e],!1!==b[a]&&""!==c[d[e]]){if(b[a]=document["querySelector"+(2===e?"All":"")](c[d[e]]),"popup"===d[e]&&!b[a])return;if(1>=e){var f=getComputedStyle(b[a]).animation;if(""===f&&(f=c[d[e]+"CloseAnimation"]),!f)return void console.error("Set the closing animation for "+d[e]);b[d[e]+"CloseAnimation"]=f}}b.$popup.ctx=b,b.openPopupHandler={handleEvent:b.openPopup,ctx:b},b.closePopupHandler={handleEvent:b.closePopup,ctx:b},b.$popup.open=b.openPopup,b.$popup.close=b.closePopup,b.initEvents(),b.initOpenBtns()},a.prototype.initEvents=function(){var a=this;if(a.$closeBtn)for(var c=0;c<a.$closeBtn.length;c++)a.$closeBtn[c]&&a.$closeBtn[c].addEventListener("click",a.closePopupHandler);a.initAnimationEndEvents(a,"popup"),a.initAnimationEndEvents(a,"overlay");var b=new CustomEvent("init");a.$popup.dispatchEvent(b)},a.prototype.initAnimationEndEvents=function(a,b){var c="$"+b;a[c]&&a[c].addEventListener("animationend",function(){var d=a[b+"CloseAnimation"].search(event.animationName);if(-1!==d){if(this.style.animation="",this.classList.remove("active"),"popup"===b){var f=new CustomEvent("close");a[c].dispatchEvent(f)}}else if(-1===d&&"popup"===b){var e=new CustomEvent("open");a[c].dispatchEvent(e)}})},a.prototype.initOpenBtns=function(){var a=this,b=a.options.openBtn;b&&(a.$openBtn={add:function(b){a.options.openBtn+=", "+b,this.refresh()},refresh:function(){this.elements=[];for(var b=document.querySelectorAll(a.options.openBtn),c=0;c<b.length;c++)this.elements.push(b[c]),b[c]&&b[c].addEventListener("click",a.openPopupHandler);a.$popup.openBtn=a.$openBtn}},a.$openBtn.refresh())},a.prototype.openPopup=function(){var a=this.ctx||this;if(a.iosFix(),a.$popup.caller=event&&event.currentTarget,!a.$popup.classList.contains("active")){a.$popup.classList.add("active"),a.pageY=pageYOffset,a.$overlay&&(a.$overlay.classList.add("active"),a.$overlay.addEventListener("click",a.closePopupHandler)),a.options.esc&&document.addEventListener("keyup",a.closePopupHandler),document.addEventListener("scroll",a.closePopupHandler);var b=new CustomEvent("beforeopen");a.$popup.dispatchEvent(b)}},a.prototype.closePopup=function(){var a=Math.abs;if(!(event&&"keyup"===event.type&&27!==event.keyCode)){var b=this.ctx||this;if(!(event&&"scroll"===event.type&&a(pageYOffset-b.pageY)<=b.options.scrollThreshold)&&!(event&&"scroll"===event.type&&0<b.$inputs.length&&b.$inputs.some(function(a){return a===document.activeElement}))){b.$popup.classList.contains("active")&&(b.$popup.style.animation=b.popupCloseAnimation,b.$overlay&&(b.$overlay.style.animation=b.overlayCloseAnimation)),b.options.esc&&document.removeEventListener("keyup",b.closePopupHandler),b.$overlay&&b.$overlay.removeEventListener("click",b.closePopupHandler),document.removeEventListener("scroll",b.closePopupHandler);var c=new CustomEvent("beforeclose");b.$popup.dispatchEvent(c)}}},a.prototype.iosFix=function(){var a=this;if(a.$inputs=[],a.iosRegExp.test(navigator.userAgent))for(var b=a.$popup.querySelectorAll("input, textarea"),c=0;c<b.length;c++)a.$inputs.push(b[c])},a});